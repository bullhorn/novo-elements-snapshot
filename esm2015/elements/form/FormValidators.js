import { Helpers } from './../../utils/Helpers';
const MAX_INTEGER = 2147483647;
const MIN_YEAR = 1753;
export class FormValidators {
    showStateRequiredFlag(subfield, control) {
        return (subfield === 'state' &&
            !Helpers.isEmpty(control.config.state) &&
            control.config.state.required &&
            Helpers.isBlank(control.value.state) &&
            control.config.state.updated &&
            !Helpers.isBlank(control.value.countryName) &&
            control.config.state.pickerConfig &&
            control.config.state.pickerConfig.defaultOptions &&
            control.config.state.pickerConfig.defaultOptions.length > 0);
    }
    // Makes sure the control value does not exceed the max integer value
    static maxInteger(control) {
        return control.value < MAX_INTEGER ? null : { integerTooLarge: true };
    }
    // Makes sure the control value is above the minimum year
    static minYear(control) {
        if (!control.value) {
            return null;
        }
        return control.value >= MIN_YEAR ? null : { minYear: true };
    }
    // Makes sure the control value does not exceed the max number value
    static maxDouble(control) {
        return control.value < Number.MAX_SAFE_INTEGER ? null : { doubleTooLarge: true };
    }
    // Make sure the control value is an email
    static isEmail(control) {
        const EMAIL_REGEXP = /^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i;
        return !control.value || EMAIL_REGEXP.test(control.value) ? null : { invalidEmail: true };
    }
    // Makes sure the control value is a valid address
    static isValidAddress(control) {
        const fieldList = ['address1', 'address2', 'city', 'state', 'zip', 'countryID'];
        const invalidAddressFields = [];
        const maxlengthFields = [];
        let returnVal = null;
        let maxlengthError = false;
        const showCountryRequiredFlag = (subfield, ctrl) => {
            return (subfield === 'countryID' &&
                !Helpers.isEmpty(ctrl.config.countryID) &&
                ctrl.config.countryID.required &&
                Helpers.isBlank(ctrl.value.countryName) &&
                ctrl.config.countryID.updated);
        };
        const showStateRequiredFlag = (subfield, ctrl) => {
            return (subfield === 'state' &&
                !Helpers.isEmpty(ctrl.config.state) &&
                ctrl.config.state.required &&
                Helpers.isBlank(ctrl.value.state) &&
                ctrl.config.state.updated &&
                !Helpers.isBlank(ctrl.value.countryName) &&
                ctrl.config.state.pickerConfig &&
                ctrl.config.state.pickerConfig.defaultOptions &&
                ctrl.config.state.pickerConfig.defaultOptions.length > 0);
        };
        if (control.value && control.config) {
            let valid = true;
            let formValidity = true;
            fieldList.forEach((subfield) => {
                if (!Helpers.isEmpty(control.config[subfield])) {
                    if ((['countryID', 'state'].indexOf(subfield) === -1 &&
                        control.config[subfield].required &&
                        !Helpers.isBlank(control.value[subfield]) &&
                        Helpers.isEmpty(control.value[subfield])) ||
                        showCountryRequiredFlag(subfield, control) ||
                        showStateRequiredFlag(subfield, control)) {
                        valid = false;
                        invalidAddressFields.push(control.config[subfield].label);
                    }
                    if (((subfield !== 'countryID' && control.config[subfield].required && Helpers.isEmpty(control.value[subfield])) ||
                        (subfield === 'countryID' &&
                            !Helpers.isEmpty(control.config.countryID) &&
                            control.config.countryID.required &&
                            Helpers.isEmpty(control.value.countryName))) &&
                        !(subfield === 'state' &&
                            !Helpers.isBlank(control.value.countryName) &&
                            control.config.state.pickerConfig &&
                            control.config.state.pickerConfig.defaultOptions &&
                            control.config.state.pickerConfig.defaultOptions.length === 0)) {
                        formValidity = false;
                    }
                    if (!Helpers.isEmpty(control.config[subfield].maxlength) &&
                        !Helpers.isEmpty(control.value[subfield]) &&
                        control.value[subfield].length > control.config[subfield].maxlength) {
                        maxlengthError = true;
                        maxlengthFields.push(subfield);
                        formValidity = false;
                    }
                }
            });
            if (!valid || !formValidity || maxlengthError) {
                returnVal = {};
            }
            if (!valid) {
                returnVal.invalidAddress = true;
                returnVal.invalidAddressFields = invalidAddressFields;
            }
            if (!formValidity) {
                returnVal.invalidAddressForForm = true;
            }
            if (maxlengthError) {
                returnVal.maxlength = true;
                returnVal.maxlengthFields = maxlengthFields;
            }
            return returnVal;
        }
        return null;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRm9ybVZhbGlkYXRvcnMuanMiLCJzb3VyY2VSb290IjoiQzovZGV2L2Rldm1hY2hpbmUvbm92by1lbGVtZW50cy9wcm9qZWN0cy9ub3ZvLWVsZW1lbnRzL3NyYy8iLCJzb3VyY2VzIjpbImVsZW1lbnRzL2Zvcm0vRm9ybVZhbGlkYXRvcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRWhELE1BQU0sV0FBVyxHQUFHLFVBQVUsQ0FBQztBQUMvQixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUM7QUFFdEIsTUFBTSxPQUFPLGNBQWM7SUFDakIscUJBQXFCLENBQUMsUUFBUSxFQUFFLE9BQU87UUFDN0MsT0FBTyxDQUNMLFFBQVEsS0FBSyxPQUFPO1lBQ3BCLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztZQUN0QyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxRQUFRO1lBQzdCLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7WUFDcEMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTztZQUM1QixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUM7WUFDM0MsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWTtZQUNqQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsY0FBYztZQUNoRCxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQzVELENBQUM7SUFDSixDQUFDO0lBRUQscUVBQXFFO0lBQ3JFLE1BQU0sQ0FBQyxVQUFVLENBQUMsT0FBTztRQUN2QixPQUFPLE9BQU8sQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxDQUFDO0lBQ3hFLENBQUM7SUFFRCx5REFBeUQ7SUFDekQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPO1FBQ3BCLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFO1lBQ2xCLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFDRCxPQUFPLE9BQU8sQ0FBQyxLQUFLLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDO0lBQzlELENBQUM7SUFFRCxvRUFBb0U7SUFDcEUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPO1FBQ3RCLE9BQU8sT0FBTyxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFDbkYsQ0FBQztJQUVELDBDQUEwQztJQUMxQyxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU87UUFDcEIsTUFBTSxZQUFZLEdBQUcsbUdBQW1HLENBQUM7UUFDekgsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFDNUYsQ0FBQztJQUNELGtEQUFrRDtJQUNsRCxNQUFNLENBQUMsY0FBYyxDQUFDLE9BQU87UUFDM0IsTUFBTSxTQUFTLEdBQWEsQ0FBQyxVQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQzFGLE1BQU0sb0JBQW9CLEdBQWEsRUFBRSxDQUFDO1FBQzFDLE1BQU0sZUFBZSxHQUFhLEVBQUUsQ0FBQztRQUNyQyxJQUFJLFNBQVMsR0FNVCxJQUFJLENBQUM7UUFDVCxJQUFJLGNBQWMsR0FBWSxLQUFLLENBQUM7UUFDcEMsTUFBTSx1QkFBdUIsR0FBRyxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsRUFBRTtZQUNqRCxPQUFPLENBQ0wsUUFBUSxLQUFLLFdBQVc7Z0JBQ3hCLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQztnQkFDdkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUTtnQkFDOUIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQztnQkFDdkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUM5QixDQUFDO1FBQ0osQ0FBQyxDQUFDO1FBRUYsTUFBTSxxQkFBcUIsR0FBRyxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQVcsRUFBRTtZQUN4RCxPQUFPLENBQ0wsUUFBUSxLQUFLLE9BQU87Z0JBQ3BCLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztnQkFDbkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUTtnQkFDMUIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQztnQkFDakMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTztnQkFDekIsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDO2dCQUN4QyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZO2dCQUM5QixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsY0FBYztnQkFDN0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUN6RCxDQUFDO1FBQ0osQ0FBQyxDQUFDO1FBRUYsSUFBSSxPQUFPLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEVBQUU7WUFDbkMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQ2pCLElBQUksWUFBWSxHQUFHLElBQUksQ0FBQztZQUN4QixTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBZ0IsRUFBRSxFQUFFO2dCQUNyQyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUU7b0JBQzlDLElBQ0UsQ0FBQyxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUM5QyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFFBQVE7d0JBQ2pDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUN6QyxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQzt3QkFDM0MsdUJBQXVCLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQzt3QkFDMUMscUJBQXFCLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxFQUN4Qzt3QkFDQSxLQUFLLEdBQUcsS0FBSyxDQUFDO3dCQUNkLG9CQUFvQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO3FCQUMzRDtvQkFDRCxJQUNFLENBQUMsQ0FBQyxRQUFRLEtBQUssV0FBVyxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsUUFBUSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO3dCQUMxRyxDQUFDLFFBQVEsS0FBSyxXQUFXOzRCQUN2QixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7NEJBQzFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVE7NEJBQ2pDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO3dCQUNoRCxDQUFDLENBQ0MsUUFBUSxLQUFLLE9BQU87NEJBQ3BCLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQzs0QkFDM0MsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWTs0QkFDakMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLGNBQWM7NEJBQ2hELE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxjQUFjLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FDOUQsRUFDRDt3QkFDQSxZQUFZLEdBQUcsS0FBSyxDQUFDO3FCQUN0QjtvQkFDRCxJQUNFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFNBQVMsQ0FBQzt3QkFDcEQsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7d0JBQ3pDLE9BQU8sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsU0FBUyxFQUNuRTt3QkFDQSxjQUFjLEdBQUcsSUFBSSxDQUFDO3dCQUN0QixlQUFlLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUMvQixZQUFZLEdBQUcsS0FBSyxDQUFDO3FCQUN0QjtpQkFDRjtZQUNILENBQUMsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLFlBQVksSUFBSSxjQUFjLEVBQUU7Z0JBQzdDLFNBQVMsR0FBRyxFQUFFLENBQUM7YUFDaEI7WUFDRCxJQUFJLENBQUMsS0FBSyxFQUFFO2dCQUNWLFNBQVMsQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO2dCQUNoQyxTQUFTLENBQUMsb0JBQW9CLEdBQUcsb0JBQW9CLENBQUM7YUFDdkQ7WUFDRCxJQUFJLENBQUMsWUFBWSxFQUFFO2dCQUNqQixTQUFTLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDO2FBQ3hDO1lBQ0QsSUFBSSxjQUFjLEVBQUU7Z0JBQ2xCLFNBQVMsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO2dCQUMzQixTQUFTLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQzthQUM3QztZQUNELE9BQU8sU0FBUyxDQUFDO1NBQ2xCO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIZWxwZXJzIH0gZnJvbSAnLi8uLi8uLi91dGlscy9IZWxwZXJzJztcclxuXHJcbmNvbnN0IE1BWF9JTlRFR0VSID0gMjE0NzQ4MzY0NztcclxuY29uc3QgTUlOX1lFQVIgPSAxNzUzO1xyXG5cclxuZXhwb3J0IGNsYXNzIEZvcm1WYWxpZGF0b3JzIHtcclxuICBwcml2YXRlIHNob3dTdGF0ZVJlcXVpcmVkRmxhZyhzdWJmaWVsZCwgY29udHJvbCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgc3ViZmllbGQgPT09ICdzdGF0ZScgJiZcclxuICAgICAgIUhlbHBlcnMuaXNFbXB0eShjb250cm9sLmNvbmZpZy5zdGF0ZSkgJiZcclxuICAgICAgY29udHJvbC5jb25maWcuc3RhdGUucmVxdWlyZWQgJiZcclxuICAgICAgSGVscGVycy5pc0JsYW5rKGNvbnRyb2wudmFsdWUuc3RhdGUpICYmXHJcbiAgICAgIGNvbnRyb2wuY29uZmlnLnN0YXRlLnVwZGF0ZWQgJiZcclxuICAgICAgIUhlbHBlcnMuaXNCbGFuayhjb250cm9sLnZhbHVlLmNvdW50cnlOYW1lKSAmJlxyXG4gICAgICBjb250cm9sLmNvbmZpZy5zdGF0ZS5waWNrZXJDb25maWcgJiZcclxuICAgICAgY29udHJvbC5jb25maWcuc3RhdGUucGlja2VyQ29uZmlnLmRlZmF1bHRPcHRpb25zICYmXHJcbiAgICAgIGNvbnRyb2wuY29uZmlnLnN0YXRlLnBpY2tlckNvbmZpZy5kZWZhdWx0T3B0aW9ucy5sZW5ndGggPiAwXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8gTWFrZXMgc3VyZSB0aGUgY29udHJvbCB2YWx1ZSBkb2VzIG5vdCBleGNlZWQgdGhlIG1heCBpbnRlZ2VyIHZhbHVlXHJcbiAgc3RhdGljIG1heEludGVnZXIoY29udHJvbCkge1xyXG4gICAgcmV0dXJuIGNvbnRyb2wudmFsdWUgPCBNQVhfSU5URUdFUiA/IG51bGwgOiB7IGludGVnZXJUb29MYXJnZTogdHJ1ZSB9O1xyXG4gIH1cclxuXHJcbiAgLy8gTWFrZXMgc3VyZSB0aGUgY29udHJvbCB2YWx1ZSBpcyBhYm92ZSB0aGUgbWluaW11bSB5ZWFyXHJcbiAgc3RhdGljIG1pblllYXIoY29udHJvbCkge1xyXG4gICAgaWYgKCFjb250cm9sLnZhbHVlKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvbnRyb2wudmFsdWUgPj0gTUlOX1lFQVIgPyBudWxsIDogeyBtaW5ZZWFyOiB0cnVlIH07XHJcbiAgfVxyXG5cclxuICAvLyBNYWtlcyBzdXJlIHRoZSBjb250cm9sIHZhbHVlIGRvZXMgbm90IGV4Y2VlZCB0aGUgbWF4IG51bWJlciB2YWx1ZVxyXG4gIHN0YXRpYyBtYXhEb3VibGUoY29udHJvbCkge1xyXG4gICAgcmV0dXJuIGNvbnRyb2wudmFsdWUgPCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiA/IG51bGwgOiB7IGRvdWJsZVRvb0xhcmdlOiB0cnVlIH07XHJcbiAgfVxyXG5cclxuICAvLyBNYWtlIHN1cmUgdGhlIGNvbnRyb2wgdmFsdWUgaXMgYW4gZW1haWxcclxuICBzdGF0aWMgaXNFbWFpbChjb250cm9sKSB7XHJcbiAgICBjb25zdCBFTUFJTF9SRUdFWFAgPSAvXlthLXowLTkhIyQlJicqK1xcLz0/Xl9ge3x9fi4tXStAW2EtejAtOV0oW2EtejAtOS1dKlthLXowLTldKT8oXFwuW2EtejAtOV0oW2EtejAtOS1dKlthLXowLTldKT8pKiQvaTtcclxuICAgIHJldHVybiAhY29udHJvbC52YWx1ZSB8fCBFTUFJTF9SRUdFWFAudGVzdChjb250cm9sLnZhbHVlKSA/IG51bGwgOiB7IGludmFsaWRFbWFpbDogdHJ1ZSB9O1xyXG4gIH1cclxuICAvLyBNYWtlcyBzdXJlIHRoZSBjb250cm9sIHZhbHVlIGlzIGEgdmFsaWQgYWRkcmVzc1xyXG4gIHN0YXRpYyBpc1ZhbGlkQWRkcmVzcyhjb250cm9sKSB7XHJcbiAgICBjb25zdCBmaWVsZExpc3Q6IHN0cmluZ1tdID0gWydhZGRyZXNzMScsICdhZGRyZXNzMicsICdjaXR5JywgJ3N0YXRlJywgJ3ppcCcsICdjb3VudHJ5SUQnXTtcclxuICAgIGNvbnN0IGludmFsaWRBZGRyZXNzRmllbGRzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgY29uc3QgbWF4bGVuZ3RoRmllbGRzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgbGV0IHJldHVyblZhbDoge1xyXG4gICAgICBpbnZhbGlkQWRkcmVzcz86IGJvb2xlYW47XHJcbiAgICAgIGludmFsaWRBZGRyZXNzRmllbGRzPzogc3RyaW5nW107XHJcbiAgICAgIGludmFsaWRBZGRyZXNzRm9yRm9ybT86IGJvb2xlYW47XHJcbiAgICAgIG1heGxlbmd0aD86IGJvb2xlYW47XHJcbiAgICAgIG1heGxlbmd0aEZpZWxkcz86IHN0cmluZ1tdO1xyXG4gICAgfSA9IG51bGw7XHJcbiAgICBsZXQgbWF4bGVuZ3RoRXJyb3I6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGNvbnN0IHNob3dDb3VudHJ5UmVxdWlyZWRGbGFnID0gKHN1YmZpZWxkLCBjdHJsKSA9PiB7XHJcbiAgICAgIHJldHVybiAoXHJcbiAgICAgICAgc3ViZmllbGQgPT09ICdjb3VudHJ5SUQnICYmXHJcbiAgICAgICAgIUhlbHBlcnMuaXNFbXB0eShjdHJsLmNvbmZpZy5jb3VudHJ5SUQpICYmXHJcbiAgICAgICAgY3RybC5jb25maWcuY291bnRyeUlELnJlcXVpcmVkICYmXHJcbiAgICAgICAgSGVscGVycy5pc0JsYW5rKGN0cmwudmFsdWUuY291bnRyeU5hbWUpICYmXHJcbiAgICAgICAgY3RybC5jb25maWcuY291bnRyeUlELnVwZGF0ZWRcclxuICAgICAgKTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3Qgc2hvd1N0YXRlUmVxdWlyZWRGbGFnID0gKHN1YmZpZWxkLCBjdHJsKTogYm9vbGVhbiA9PiB7XHJcbiAgICAgIHJldHVybiAoXHJcbiAgICAgICAgc3ViZmllbGQgPT09ICdzdGF0ZScgJiZcclxuICAgICAgICAhSGVscGVycy5pc0VtcHR5KGN0cmwuY29uZmlnLnN0YXRlKSAmJlxyXG4gICAgICAgIGN0cmwuY29uZmlnLnN0YXRlLnJlcXVpcmVkICYmXHJcbiAgICAgICAgSGVscGVycy5pc0JsYW5rKGN0cmwudmFsdWUuc3RhdGUpICYmXHJcbiAgICAgICAgY3RybC5jb25maWcuc3RhdGUudXBkYXRlZCAmJlxyXG4gICAgICAgICFIZWxwZXJzLmlzQmxhbmsoY3RybC52YWx1ZS5jb3VudHJ5TmFtZSkgJiZcclxuICAgICAgICBjdHJsLmNvbmZpZy5zdGF0ZS5waWNrZXJDb25maWcgJiZcclxuICAgICAgICBjdHJsLmNvbmZpZy5zdGF0ZS5waWNrZXJDb25maWcuZGVmYXVsdE9wdGlvbnMgJiZcclxuICAgICAgICBjdHJsLmNvbmZpZy5zdGF0ZS5waWNrZXJDb25maWcuZGVmYXVsdE9wdGlvbnMubGVuZ3RoID4gMFxyXG4gICAgICApO1xyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoY29udHJvbC52YWx1ZSAmJiBjb250cm9sLmNvbmZpZykge1xyXG4gICAgICBsZXQgdmFsaWQgPSB0cnVlO1xyXG4gICAgICBsZXQgZm9ybVZhbGlkaXR5ID0gdHJ1ZTtcclxuICAgICAgZmllbGRMaXN0LmZvckVhY2goKHN1YmZpZWxkOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAoIUhlbHBlcnMuaXNFbXB0eShjb250cm9sLmNvbmZpZ1tzdWJmaWVsZF0pKSB7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIChbJ2NvdW50cnlJRCcsICdzdGF0ZSddLmluZGV4T2Yoc3ViZmllbGQpID09PSAtMSAmJlxyXG4gICAgICAgICAgICAgIGNvbnRyb2wuY29uZmlnW3N1YmZpZWxkXS5yZXF1aXJlZCAmJlxyXG4gICAgICAgICAgICAgICFIZWxwZXJzLmlzQmxhbmsoY29udHJvbC52YWx1ZVtzdWJmaWVsZF0pICYmXHJcbiAgICAgICAgICAgICAgSGVscGVycy5pc0VtcHR5KGNvbnRyb2wudmFsdWVbc3ViZmllbGRdKSkgfHxcclxuICAgICAgICAgICAgc2hvd0NvdW50cnlSZXF1aXJlZEZsYWcoc3ViZmllbGQsIGNvbnRyb2wpIHx8XHJcbiAgICAgICAgICAgIHNob3dTdGF0ZVJlcXVpcmVkRmxhZyhzdWJmaWVsZCwgY29udHJvbClcclxuICAgICAgICAgICkge1xyXG4gICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpbnZhbGlkQWRkcmVzc0ZpZWxkcy5wdXNoKGNvbnRyb2wuY29uZmlnW3N1YmZpZWxkXS5sYWJlbCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICgoc3ViZmllbGQgIT09ICdjb3VudHJ5SUQnICYmIGNvbnRyb2wuY29uZmlnW3N1YmZpZWxkXS5yZXF1aXJlZCAmJiBIZWxwZXJzLmlzRW1wdHkoY29udHJvbC52YWx1ZVtzdWJmaWVsZF0pKSB8fFxyXG4gICAgICAgICAgICAgIChzdWJmaWVsZCA9PT0gJ2NvdW50cnlJRCcgJiZcclxuICAgICAgICAgICAgICAgICFIZWxwZXJzLmlzRW1wdHkoY29udHJvbC5jb25maWcuY291bnRyeUlEKSAmJlxyXG4gICAgICAgICAgICAgICAgY29udHJvbC5jb25maWcuY291bnRyeUlELnJlcXVpcmVkICYmXHJcbiAgICAgICAgICAgICAgICBIZWxwZXJzLmlzRW1wdHkoY29udHJvbC52YWx1ZS5jb3VudHJ5TmFtZSkpKSAmJlxyXG4gICAgICAgICAgICAhKFxyXG4gICAgICAgICAgICAgIHN1YmZpZWxkID09PSAnc3RhdGUnICYmXHJcbiAgICAgICAgICAgICAgIUhlbHBlcnMuaXNCbGFuayhjb250cm9sLnZhbHVlLmNvdW50cnlOYW1lKSAmJlxyXG4gICAgICAgICAgICAgIGNvbnRyb2wuY29uZmlnLnN0YXRlLnBpY2tlckNvbmZpZyAmJlxyXG4gICAgICAgICAgICAgIGNvbnRyb2wuY29uZmlnLnN0YXRlLnBpY2tlckNvbmZpZy5kZWZhdWx0T3B0aW9ucyAmJlxyXG4gICAgICAgICAgICAgIGNvbnRyb2wuY29uZmlnLnN0YXRlLnBpY2tlckNvbmZpZy5kZWZhdWx0T3B0aW9ucy5sZW5ndGggPT09IDBcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIGZvcm1WYWxpZGl0eSA9IGZhbHNlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAhSGVscGVycy5pc0VtcHR5KGNvbnRyb2wuY29uZmlnW3N1YmZpZWxkXS5tYXhsZW5ndGgpICYmXHJcbiAgICAgICAgICAgICFIZWxwZXJzLmlzRW1wdHkoY29udHJvbC52YWx1ZVtzdWJmaWVsZF0pICYmXHJcbiAgICAgICAgICAgIGNvbnRyb2wudmFsdWVbc3ViZmllbGRdLmxlbmd0aCA+IGNvbnRyb2wuY29uZmlnW3N1YmZpZWxkXS5tYXhsZW5ndGhcclxuICAgICAgICAgICkge1xyXG4gICAgICAgICAgICBtYXhsZW5ndGhFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgIG1heGxlbmd0aEZpZWxkcy5wdXNoKHN1YmZpZWxkKTtcclxuICAgICAgICAgICAgZm9ybVZhbGlkaXR5ID0gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgaWYgKCF2YWxpZCB8fCAhZm9ybVZhbGlkaXR5IHx8IG1heGxlbmd0aEVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuVmFsID0ge307XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCF2YWxpZCkge1xyXG4gICAgICAgIHJldHVyblZhbC5pbnZhbGlkQWRkcmVzcyA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuVmFsLmludmFsaWRBZGRyZXNzRmllbGRzID0gaW52YWxpZEFkZHJlc3NGaWVsZHM7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCFmb3JtVmFsaWRpdHkpIHtcclxuICAgICAgICByZXR1cm5WYWwuaW52YWxpZEFkZHJlc3NGb3JGb3JtID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobWF4bGVuZ3RoRXJyb3IpIHtcclxuICAgICAgICByZXR1cm5WYWwubWF4bGVuZ3RoID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm5WYWwubWF4bGVuZ3RoRmllbGRzID0gbWF4bGVuZ3RoRmllbGRzO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiByZXR1cm5WYWw7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuIl19