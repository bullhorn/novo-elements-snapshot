import { ChangeDetectionStrategy, Component, ContentChildren, forwardRef, Input, QueryList, ChangeDetectorRef } from '@angular/core';
import { ControlContainer, FormBuilder, NG_VALUE_ACCESSOR, Validators } from '@angular/forms';
import { Subject } from 'rxjs';
import { NovoConditionFieldDef } from '../query-builder.directives';
import { NOVO_CRITERIA_BUILDER } from '../query-builder.tokens';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "../../flex/Flex";
import * as i3 from "../../common/typography/caption/caption.component";
import * as i4 from "../../common/typography/text/text.component";
import * as i5 from "../condition-builder/condition-builder.component";
import * as i6 from "../../button/Button";
import * as i7 from "../condition-definitions/id-condition.definition";
import * as i8 from "../condition-definitions/date-condition.definition";
import * as i9 from "../condition-definitions/string-condition.definition";
import * as i10 from "../condition-definitions/number-condition.definition";
import * as i11 from "../condition-definitions/address-condition.definition";
import * as i12 from "../condition-definitions/boolean-condition.definition";
import * as i13 from "../condition-definitions/picker-condition.definition";
import * as i14 from "@angular/common";
import * as i15 from "../../common/directives/space.directive";
import * as i16 from "../../common/directives/theme.directive";
export class CriteriaBuilderComponent {
    constructor(controlContainer, formBuilder, cdr) {
        this.controlContainer = controlContainer;
        this.formBuilder = formBuilder;
        this.cdr = cdr;
        this.orEnabled = false;
        this.addCriteriaLabel = 'Add Criteria';
        this._customFieldDefs = new Set();
        this._fieldDefsByName = new Map();
        /** Subject that emits when the component has been destroyed. */
        this._onDestroy = new Subject();
    }
    ngOnInit() {
        this.parentForm = this.controlContainer.control;
        Promise.resolve().then(() => this.addAndGroup());
    }
    ngAfterContentChecked() {
        this._cacheFieldDefs();
    }
    ngOnDestroy() {
        // Clear all outlets and Maps
        [this._customFieldDefs, this._fieldDefsByName].forEach((def) => {
            def.clear();
        });
        this._onDestroy.next();
        this._onDestroy.complete();
    }
    handleAddOrFilter(evt) {
    }
    handleAddAndFilter(evt) {
        this.addAndGroup();
    }
    andGroups() {
        return this.parentForm.get(this.controlName);
    }
    newAndGroup(data) {
        return this.formBuilder.group({
            $or: this.formBuilder.array([this.newOrGroup(data)]),
        });
    }
    addAndGroup(data) {
        this.andGroups().push(this.newAndGroup(data));
        this.cdr.markForCheck();
    }
    removeAndGroup(index) {
        this.andGroups().removeAt(index);
        this.cdr.markForCheck();
    }
    orGroups(index) {
        return this.andGroups().at(index).get('$or');
    }
    newOrGroup(data) {
        return this.formBuilder.group(data || {
            field: [null, Validators.required],
            operator: [null, Validators.required],
            value: [null, Validators.required],
        });
    }
    addOrGroup(index) {
        this.orGroups(index).push(this.newOrGroup());
        this.cdr.markForCheck();
    }
    removeOrGroup(index, orIndex) {
        this.orGroups(index).removeAt(orIndex);
        if (!this.orGroups(index).controls.length) {
            this.removeAndGroup(index);
        }
        this.cdr.markForCheck();
    }
    resetQueryForm() {
        while (this.parentForm['controls'][this.controlName].length !== 0) {
            this.parentForm['controls'][this.controlName].removeAt(0);
        }
    }
    canAddGroup() {
        if (this.andGroups().controls.length < 1)
            return true;
        const len = this.andGroups().controls.length - 1;
        const last = this.orGroups(len).controls.length - 1;
        const { field, value } = this.orGroups(len).at(last).value;
        return !!field && !!value;
    }
    /** Adds a field definition that was not included as part of the content children. */
    addFieldDef(fieldDef) {
        this._customFieldDefs.add(fieldDef);
    }
    /** Removes a field definition that was not included as part of the content children. */
    removeFieldDef(fieldDef) {
        this._customFieldDefs.delete(fieldDef);
    }
    getFieldDefsByName() {
        return this._fieldDefsByName;
    }
    _cacheFieldDefs() {
        this._fieldDefsByName.clear();
        const defs = [
            // Dynamically Added Definitions
            ...Array.from(this._customFieldDefs),
            ...Array.from(this._contentFieldDefs),
        ];
        defs.forEach((fieldDef) => {
            if (this._fieldDefsByName.has(fieldDef.name)) {
                // throw new Error(`duplicate field name for ${fieldDef.name}`);
            }
            this._fieldDefsByName.set(fieldDef.name, fieldDef);
        });
    }
}
CriteriaBuilderComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.11", ngImport: i0, type: CriteriaBuilderComponent, deps: [{ token: i1.ControlContainer }, { token: i1.FormBuilder }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
CriteriaBuilderComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.11", type: CriteriaBuilderComponent, selector: "novo-criteria-builder", inputs: { config: "config", controlName: "controlName", orEnabled: "orEnabled", addCriteriaLabel: "addCriteriaLabel", editTypeFn: "editTypeFn" }, host: { classAttribute: "novo-criteria-builder" }, providers: [
        { provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() => CriteriaBuilderComponent), multi: true },
        { provide: NOVO_CRITERIA_BUILDER, useExisting: CriteriaBuilderComponent },
    ], queries: [{ propertyName: "_contentFieldDefs", predicate: NovoConditionFieldDef, descendants: true }], ngImport: i0, template: "<form [formGroup]=\"parentForm\">\n  <novo-stack [formArrayName]=\"controlName\" class=\"criteria-builder-inner\">\n    <ng-container *ngFor=\"let andGroup of andGroups().controls; let andIndex = index; let isFirst = first;\">\n      <div *ngIf=\"!isFirst\" class=\"and-connector\" aria-hidden=\"false\">\n        <div class=\"and-connector-line\"></div>\n        <novo-caption class=\"and-connector-text\">and</novo-caption>\n      </div>\n      <ng-container [formGroupName]=\"andIndex\">\n        <novo-stack\n          class=\"condition-group\"\n          [class.with-conditions]=\"orGroups(andIndex).controls.length > 1\"\n          [class.with-one-condition]=\"orGroups(andIndex).controls.length == 1\"\n          formArrayName=\"$or\">\n          <ng-container\n            *ngFor=\"\n              let orGroup of orGroups(andIndex).controls;\n              let orIndex = index;\n              let isFirstOr = first;\n              let isLastOr = last;\n            \">\n            <novo-flex class=\"condition-row\" [class.or-block]=\"orGroups(andIndex).controls.length > 1 && !isLastOr\">\n              <div *ngIf=\"!isFirstOr\" class=\"or-connector\" aria-hidden=\"false\">\n                <!-- <div class=\"or-connector-line\"></div> -->\n                <novo-text class=\"or-connector-text\" color=\"ocean\" weight=\"bold\" padding=\"sm\" mx=\"lg\">OR</novo-text>\n              </div>\n              <novo-condition-builder [formGroupName]=\"orIndex\" [config]=\"config\" [editTypeFn]=\"editTypeFn\">\n              </novo-condition-builder>\n              <button *ngIf=\"isLastOr && orEnabled\" theme=\"secondary\" size=\"sm\" class=\"and-or-button\"\n                (click)=\"addOrGroup(andIndex)\">Or</button>\n              <novo-button theme=\"icon\" icon=\"delete-o\" color=\"negative\" (click)=\"removeOrGroup(andIndex, orIndex)\">\n              </novo-button>\n            </novo-flex>\n          </ng-container>\n        </novo-stack>\n      </ng-container>\n    </ng-container>\n  </novo-stack>\n  <button class=\"and-or-button\" theme=\"secondary\" size=\"sm\" (click)=\"addAndGroup()\">{{ addCriteriaLabel }}</button>\n\n</form>\n<novo-id-condition-def name=\"ID\"></novo-id-condition-def>\n<novo-date-condition-def name=\"TIMESTAMP\"></novo-date-condition-def>\n<novo-string-condition-def name=\"STRING\"></novo-string-condition-def>\n<novo-number-condition-def name=\"FLOAT\"></novo-number-condition-def>\n<novo-number-condition-def name=\"INTEGER\"></novo-number-condition-def>\n<novo-number-condition-def name=\"BIGDECIMAL\"></novo-number-condition-def>\n<novo-number-condition-def name=\"DOUBLE\"></novo-number-condition-def>\n<novo-address-condition-def name=\"ADDRESS\"></novo-address-condition-def>\n<novo-boolean-condition-def name=\"BOOLEAN\"></novo-boolean-condition-def>\n<novo-picker-condition-def name=\"SELECT\"></novo-picker-condition-def>\n<novo-string-condition-def name=\"DEFAULT\"></novo-string-condition-def>\n\n<!-- \n  {\n    $and: [{\n      $or: [{\n        entity: 'JobOrder'\n        field: 'categories',\n        operator: 'doesNotContain',\n        value: 'Healthcare'\n      }]\n    }]\n  }\n -->", styles: [":host{position:relative;display:block}:host .criteria-builder-inner{padding-bottom:1rem}:host .criteria-builder-inner .condition-row{width:100%;padding-bottom:.4rem}:host .criteria-builder-inner .condition-group{width:100%;border:1px solid transparent;border-radius:.4rem;padding:1rem 0}:host .criteria-builder-inner .condition-group.with-conditions{padding:.5rem;border-color:#e6e6e6}:host .criteria-builder-inner .condition-group.with-one-condition{border-bottom:1px solid #e6e6e6}:host .and-or-button{box-sizing:border-box;background:#fff;border:1px solid #ddd;color:#5691f5;display:inline-block;position:relative;cursor:pointer;margin:.4rem;align-items:center;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;outline:none;white-space:nowrap;text-transform:uppercase;transition:box-shadow .4s cubic-bezier(.25,.8,.25,1),background-color .4s cubic-bezier(.25,.8,.25,1)}:host .and-connector{background:#fff;padding:0 5px;position:relative;width:100%}:host .and-connector .and-connector-line{height:1px;width:100%}:host .and-connector .and-connector-text{background-color:#fff;background-color:var(--background-alt, #ffffff);margin:-8px 0 0 10px;position:absolute;text-align:center;text-transform:uppercase}\n"], components: [{ type: i2.NovoStackElement, selector: "novo-stack,novo-column", inputs: ["direction", "align"] }, { type: i3.NovoCaption, selector: "novo-caption,[novo-caption]" }, { type: i2.NovoFlexElement, selector: "novo-flex,novo-row", inputs: ["direction", "align", "justify", "wrap", "gap"] }, { type: i4.NovoText, selector: "novo-text,[novo-text]", inputs: ["block"] }, { type: i5.ConditionBuilderComponent, selector: "novo-condition-builder", inputs: ["label", "config", "editTypeFn"] }, { type: i6.NovoButtonElement, selector: "novo-button,button[theme]", inputs: ["color", "side", "size", "theme", "loading", "icon", "disabled"] }, { type: i7.NovoDefaultIdConditionDef, selector: "novo-id-condition-def" }, { type: i8.NovoDefaultDateConditionDef, selector: "novo-date-condition-def" }, { type: i9.NovoDefaultStringConditionDef, selector: "novo-string-condition-def" }, { type: i10.NovoDefaultNumberConditionDef, selector: "novo-number-condition-def" }, { type: i11.NovoDefaultAddressConditionDef, selector: "novo-address-condition-def" }, { type: i12.NovoDefaultBooleanConditionDef, selector: "novo-boolean-condition-def" }, { type: i13.NovoDefaultPickerConditionDef, selector: "novo-picker-condition-def" }], directives: [{ type: i1.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { type: i1.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { type: i1.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { type: i1.FormArrayName, selector: "[formArrayName]", inputs: ["formArrayName"] }, { type: i14.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i14.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i1.FormGroupName, selector: "[formGroupName]", inputs: ["formGroupName"] }, { type: i15.PaddingDirective, selector: "[p],[padding],[paddingTop],[paddingRight],[paddingBottom],[paddingLeft],[paddingX],[paddingY],[pt],[pr],[pb],[pl],[px],[py]", inputs: ["padding", "p", "paddingLeft", "pl", "paddingRight", "pr", "paddingTop", "pt", "paddingBottom", "pb", "paddingX", "px", "paddingY", "py"] }, { type: i15.MarginDirective, selector: "[m],[margin],[marginTop],[marginRight],[marginBottom],[marginLeft],[marginX],[marginY],[mt],[mr],[mb],[ml],[mx],[my]", inputs: ["margin", "m", "marginLeft", "ml", "marginRight", "mr", "marginTop", "mt", "marginBottom", "mb", "marginX", "mx", "marginY", "my"] }, { type: i16.ThemeColorDirective, selector: "[theme]", inputs: ["theme"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.11", ngImport: i0, type: CriteriaBuilderComponent, decorators: [{
            type: Component,
            args: [{ selector: 'novo-criteria-builder', changeDetection: ChangeDetectionStrategy.OnPush, providers: [
                        { provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() => CriteriaBuilderComponent), multi: true },
                        { provide: NOVO_CRITERIA_BUILDER, useExisting: CriteriaBuilderComponent },
                    ], host: {
                        class: 'novo-criteria-builder',
                    }, template: "<form [formGroup]=\"parentForm\">\n  <novo-stack [formArrayName]=\"controlName\" class=\"criteria-builder-inner\">\n    <ng-container *ngFor=\"let andGroup of andGroups().controls; let andIndex = index; let isFirst = first;\">\n      <div *ngIf=\"!isFirst\" class=\"and-connector\" aria-hidden=\"false\">\n        <div class=\"and-connector-line\"></div>\n        <novo-caption class=\"and-connector-text\">and</novo-caption>\n      </div>\n      <ng-container [formGroupName]=\"andIndex\">\n        <novo-stack\n          class=\"condition-group\"\n          [class.with-conditions]=\"orGroups(andIndex).controls.length > 1\"\n          [class.with-one-condition]=\"orGroups(andIndex).controls.length == 1\"\n          formArrayName=\"$or\">\n          <ng-container\n            *ngFor=\"\n              let orGroup of orGroups(andIndex).controls;\n              let orIndex = index;\n              let isFirstOr = first;\n              let isLastOr = last;\n            \">\n            <novo-flex class=\"condition-row\" [class.or-block]=\"orGroups(andIndex).controls.length > 1 && !isLastOr\">\n              <div *ngIf=\"!isFirstOr\" class=\"or-connector\" aria-hidden=\"false\">\n                <!-- <div class=\"or-connector-line\"></div> -->\n                <novo-text class=\"or-connector-text\" color=\"ocean\" weight=\"bold\" padding=\"sm\" mx=\"lg\">OR</novo-text>\n              </div>\n              <novo-condition-builder [formGroupName]=\"orIndex\" [config]=\"config\" [editTypeFn]=\"editTypeFn\">\n              </novo-condition-builder>\n              <button *ngIf=\"isLastOr && orEnabled\" theme=\"secondary\" size=\"sm\" class=\"and-or-button\"\n                (click)=\"addOrGroup(andIndex)\">Or</button>\n              <novo-button theme=\"icon\" icon=\"delete-o\" color=\"negative\" (click)=\"removeOrGroup(andIndex, orIndex)\">\n              </novo-button>\n            </novo-flex>\n          </ng-container>\n        </novo-stack>\n      </ng-container>\n    </ng-container>\n  </novo-stack>\n  <button class=\"and-or-button\" theme=\"secondary\" size=\"sm\" (click)=\"addAndGroup()\">{{ addCriteriaLabel }}</button>\n\n</form>\n<novo-id-condition-def name=\"ID\"></novo-id-condition-def>\n<novo-date-condition-def name=\"TIMESTAMP\"></novo-date-condition-def>\n<novo-string-condition-def name=\"STRING\"></novo-string-condition-def>\n<novo-number-condition-def name=\"FLOAT\"></novo-number-condition-def>\n<novo-number-condition-def name=\"INTEGER\"></novo-number-condition-def>\n<novo-number-condition-def name=\"BIGDECIMAL\"></novo-number-condition-def>\n<novo-number-condition-def name=\"DOUBLE\"></novo-number-condition-def>\n<novo-address-condition-def name=\"ADDRESS\"></novo-address-condition-def>\n<novo-boolean-condition-def name=\"BOOLEAN\"></novo-boolean-condition-def>\n<novo-picker-condition-def name=\"SELECT\"></novo-picker-condition-def>\n<novo-string-condition-def name=\"DEFAULT\"></novo-string-condition-def>\n\n<!-- \n  {\n    $and: [{\n      $or: [{\n        entity: 'JobOrder'\n        field: 'categories',\n        operator: 'doesNotContain',\n        value: 'Healthcare'\n      }]\n    }]\n  }\n -->", styles: [":host{position:relative;display:block}:host .criteria-builder-inner{padding-bottom:1rem}:host .criteria-builder-inner .condition-row{width:100%;padding-bottom:.4rem}:host .criteria-builder-inner .condition-group{width:100%;border:1px solid transparent;border-radius:.4rem;padding:1rem 0}:host .criteria-builder-inner .condition-group.with-conditions{padding:.5rem;border-color:#e6e6e6}:host .criteria-builder-inner .condition-group.with-one-condition{border-bottom:1px solid #e6e6e6}:host .and-or-button{box-sizing:border-box;background:#fff;border:1px solid #ddd;color:#5691f5;display:inline-block;position:relative;cursor:pointer;margin:.4rem;align-items:center;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;outline:none;white-space:nowrap;text-transform:uppercase;transition:box-shadow .4s cubic-bezier(.25,.8,.25,1),background-color .4s cubic-bezier(.25,.8,.25,1)}:host .and-connector{background:#fff;padding:0 5px;position:relative;width:100%}:host .and-connector .and-connector-line{height:1px;width:100%}:host .and-connector .and-connector-text{background-color:#fff;background-color:var(--background-alt, #ffffff);margin:-8px 0 0 10px;position:absolute;text-align:center;text-transform:uppercase}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ControlContainer }, { type: i1.FormBuilder }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { config: [{
                type: Input
            }], controlName: [{
                type: Input
            }], orEnabled: [{
                type: Input
            }], addCriteriaLabel: [{
                type: Input
            }], editTypeFn: [{
                type: Input
            }], _contentFieldDefs: [{
                type: ContentChildren,
                args: [NovoConditionFieldDef, { descendants: true }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JpdGVyaWEtYnVpbGRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9ub3ZvLWVsZW1lbnRzL3NyYy9lbGVtZW50cy9xdWVyeS1idWlsZGVyL2NyaXRlcmlhLWJ1aWxkZXIvY3JpdGVyaWEtYnVpbGRlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9ub3ZvLWVsZW1lbnRzL3NyYy9lbGVtZW50cy9xdWVyeS1idWlsZGVyL2NyaXRlcmlhLWJ1aWxkZXIvY3JpdGVyaWEtYnVpbGRlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQXVCLHVCQUF1QixFQUFFLFNBQVMsRUFBRSxlQUFlLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBcUIsU0FBUyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdLLE9BQU8sRUFBbUIsZ0JBQWdCLEVBQWEsV0FBVyxFQUFhLGlCQUFpQixFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JJLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUF5QixxQkFBcUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzNGLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHlCQUF5QixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQmhFLE1BQU0sT0FBTyx3QkFBd0I7SUFlbkMsWUFBb0IsZ0JBQWtDLEVBQVUsV0FBd0IsRUFBVSxHQUFzQjtRQUFwRyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQVUsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFBVSxRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQVgvRyxjQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLHFCQUFnQixHQUFHLGNBQWMsQ0FBQztRQUtuQyxxQkFBZ0IsR0FBRyxJ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K0JBQ0UsdUJBQXVCLG1CQUdoQix1QkFBdUIsQ0FBQyxNQUFNLGFBQ3BDO3dCQUNULEVBQUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLHlCQUF5QixDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTt3QkFDcEcsRUFBRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsV0FBVywwQkFBMEIsRUFBRTtxQkFDMUUsUUFDSzt3QkFDSixLQUFLLEVBQUUsdUJBQXVCO3FCQUMvQjtpS0FJUSxNQUFNO3NCQUFkLEtBQUs7Z0JBQ0csV0FBVztzQkFBbkIsS0FBSztnQkFDRyxTQUFTO3NCQUFqQixLQUFLO2dCQUNHLGdCQUFnQjtzQkFBeEIsS0FBSztnQkFDRyxVQUFVO3NCQUFsQixLQUFLO2dCQUV5RCxpQkFBaUI7c0JBQS9FLGVBQWU7dUJBQUMscUJBQXFCLEVBQUUsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJDb250ZW50Q2hlY2tlZCwgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgQ29udGVudENoaWxkcmVuLCBmb3J3YXJkUmVmLCBJbnB1dCwgT25EZXN0cm95LCBPbkluaXQsIFF1ZXJ5TGlzdCwgQ2hhbmdlRGV0ZWN0b3JSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgQ29udHJvbENvbnRhaW5lciwgRm9ybUFycmF5LCBGb3JtQnVpbGRlciwgRm9ybUdyb3VwLCBOR19WQUxVRV9BQ0NFU1NPUiwgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEJhc2VDb25kaXRpb25GaWVsZERlZiwgTm92b0NvbmRpdGlvbkZpZWxkRGVmIH0gZnJvbSAnLi4vcXVlcnktYnVpbGRlci5kaXJlY3RpdmVzJztcbmltcG9ydCB7IE5PVk9fQ1JJVEVSSUFfQlVJTERFUiB9IGZyb20gJy4uL3F1ZXJ5LWJ1aWxkZXIudG9rZW5zJztcbmltcG9ydCB7IEJhc2VGaWVsZERlZiB9IGZyb20gJy4uL3F1ZXJ5LWJ1aWxkZXIudHlwZXMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdub3ZvLWNyaXRlcmlhLWJ1aWxkZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vY3JpdGVyaWEtYnVpbGRlci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2NyaXRlcmlhLWJ1aWxkZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHByb3ZpZGVyczogW1xuICAgIHsgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IENyaXRlcmlhQnVpbGRlckNvbXBvbmVudCksIG11bHRpOiB0cnVlIH0sXG4gICAgeyBwcm92aWRlOiBOT1ZPX0NSSVRFUklBX0JVSUxERVIsIHVzZUV4aXN0aW5nOiBDcml0ZXJpYUJ1aWxkZXJDb21wb25lbnQgfSxcbiAgXSxcbiAgaG9zdDoge1xuICAgIGNsYXNzOiAnbm92by1jcml0ZXJpYS1idWlsZGVyJyxcbiAgfSxcbn0pXG5leHBvcnQgY2xhc3MgQ3JpdGVyaWFCdWlsZGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIEFmdGVyQ29udGVudENoZWNrZWQge1xuICBwdWJsaWMgcGFyZW50Rm9ybTogQWJzdHJhY3RDb250cm9sO1xuICBASW5wdXQoKSBjb25maWc6IGFueTtcbiAgQElucHV0KCkgY29udHJvbE5hbWU6IHN0cmluZztcbiAgQElucHV0KCkgb3JFbmFibGVkID0gZmFsc2U7XG4gIEBJbnB1dCgpIGFkZENyaXRlcmlhTGFiZWwgPSAnQWRkIENyaXRlcmlhJztcbiAgQElucHV0KCkgZWRpdFR5cGVGbjogKGZpZWxkOiBCYXNlRmllbGREZWYpID0+IHN0cmluZztcblxuICBAQ29udGVudENoaWxkcmVuKE5vdm9Db25kaXRpb25GaWVsZERlZiwgeyBkZXNjZW5kYW50czogdHJ1ZSB9KSBfY29udGVudEZpZWxkRGVmczogUXVlcnlMaXN0PE5vdm9Db25kaXRpb25GaWVsZERlZj47XG5cbiAgcHJpdmF0ZSBfY3VzdG9tRmllbGREZWZzID0gbmV3IFNldDxCYXNlQ29uZGl0aW9uRmllbGREZWY+KCk7XG4gIHByaXZhdGUgX2ZpZWxkRGVmc0J5TmFtZSA9IG5ldyBNYXA8c3RyaW5nLCBCYXNlQ29uZGl0aW9uRmllbGREZWY+KCk7XG4gIC8qKiBTdWJqZWN0IHRoYXQgZW1pdHMgd2hlbiB0aGUgY29tcG9uZW50IGhhcyBiZWVuIGRlc3Ryb3llZC4gKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfb25EZXN0cm95ID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbnRyb2xDb250YWluZXI6IENvbnRyb2xDb250YWluZXIsIHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLCBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5wYXJlbnRGb3JtID0gdGhpcy5jb250cm9sQ29udGFpbmVyLmNvbnRyb2w7XG4gICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiB0aGlzLmFkZEFuZEdyb3VwKCkpO1xuICB9XG4gIFxuICBuZ0FmdGVyQ29udGVudENoZWNrZWQoKSB7XG4gICAgdGhpcy5fY2FjaGVGaWVsZERlZnMoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIC8vIENsZWFyIGFsbCBvdXRsZXRzIGFuZCBNYXBzXG4gICAgW3RoaXMuX2N1c3RvbUZpZWxkRGVmcywgdGhpcy5fZmllbGREZWZzQnlOYW1lXS5mb3JFYWNoKChkZWYpID0+IHtcbiAgICAgIGRlZi5jbGVhcigpO1xuICAgIH0pO1xuICAgIHRoaXMuX29uRGVzdHJveS5uZXh0KCk7XG4gICAgdGhpcy5fb25EZXN0cm95LmNvbXBsZXRlKCk7XG4gIH1cblxuICBoYW5kbGVBZGRPckZpbHRlcihldnQ6IGFueSkge1xuICB9XG5cbiAgaGFuZGxlQWRkQW5kRmlsdGVyKGV2dDogYW55KSB7XG4gICAgdGhpcy5hZGRBbmRHcm91cCgpO1xuICB9XG5cbiAgYW5kR3JvdXBzKCk6IEZvcm1BcnJheSB7XG4gICAgcmV0dXJuIHRoaXMucGFyZW50Rm9ybS5nZXQodGhpcy5jb250cm9sTmFtZSkgYXMgRm9ybUFycmF5O1xuICB9XG5cbiAgbmV3QW5kR3JvdXAoZGF0YT86IGFueSk6IEZvcm1Hcm91cCB7XG4gICAgcmV0dXJuIHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoe1xuICAgICAgJG9yOiB0aGlzLmZvcm1CdWlsZGVyLmFycmF5KFt0aGlzLm5ld09yR3JvdXAoZGF0YSldKSxcbiAgICB9KTtcbiAgfVxuXG4gIGFkZEFuZEdyb3VwKGRhdGE/OiBhbnkpIHtcbiAgICB0aGlzLmFuZEdyb3VwcygpLnB1c2godGhpcy5uZXdBbmRHcm91cChkYXRhKSk7XG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICByZW1vdmVBbmRHcm91cChpbmRleDogbnVtYmVyKSB7XG4gICAgdGhpcy5hbmRHcm91cHMoKS5yZW1vdmVBdChpbmRleCk7XG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICBvckdyb3VwcyhpbmRleDogbnVtYmVyKTogRm9ybUFycmF5IHtcbiAgICByZXR1cm4gdGhpcy5hbmRHcm91cHMoKS5hdChpbmRleCkuZ2V0KCckb3InKSBhcyBGb3JtQXJyYXk7XG4gIH1cblxuICBuZXdPckdyb3VwKGRhdGE/OiBhbnkpOiBGb3JtR3JvdXAge1xuICAgIHJldHVybiB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKGRhdGEgfHwge1xuICAgICAgZmllbGQ6IFtudWxsLCBWYWxpZGF0b3JzLnJlcXVpcmVkXSxcbiAgICAgIG9wZXJhdG9yOiBbbnVsbCwgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXG4gICAgICB2YWx1ZTogW251bGwsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgIH0pO1xuICB9XG5cbiAgYWRkT3JHcm91cChpbmRleDogbnVtYmVyKSB7XG4gICAgdGhpcy5vckdyb3VwcyhpbmRleCkucHVzaCh0aGlzLm5ld09yR3JvdXAoKSk7XG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICByZW1vdmVPckdyb3VwKGluZGV4OiBudW1iZXIsIG9ySW5kZXg6IG51bWJlcikge1xuICAgIHRoaXMub3JHcm91cHMoaW5kZXgpLnJlbW92ZUF0KG9ySW5kZXgpO1xuICAgIGlmICghdGhpcy5vckdyb3VwcyhpbmRleCkuY29udHJvbHMubGVuZ3RoKSB7XG4gICAgICB0aGlzLnJlbW92ZUFuZEdyb3VwKGluZGV4KTtcbiAgICB9XG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICByZXNldFF1ZXJ5Rm9ybSgpIHtcbiAgICB3aGlsZSAodGhpcy5wYXJlbnRGb3JtWydjb250cm9scyddW3RoaXMuY29udHJvbE5hbWVdLmxlbmd0aCAhPT0gMCkge1xuICAgICAgdGhpcy5wYXJlbnRGb3JtWydjb250cm9scyddW3RoaXMuY29udHJvbE5hbWVdLnJlbW92ZUF0KDApXG4gICAgfVxuICB9XG5cbiAgY2FuQWRkR3JvdXAoKSB7XG4gICAgaWYgKHRoaXMuYW5kR3JvdXBzKCkuY29udHJvbHMubGVuZ3RoIDwgMSkgcmV0dXJuIHRydWU7XG4gICAgY29uc3QgbGVuID0gdGhpcy5hbmRHcm91cHMoKS5jb250cm9scy5sZW5ndGggLSAxO1xuICAgIGNvbnN0IGxhc3QgPSB0aGlzLm9yR3JvdXBzKGxlbikuY29udHJvbHMubGVuZ3RoIC0gMTtcbiAgICBjb25zdCB7IGZpZWxkLCB2YWx1ZSB9ID0gdGhpcy5vckdyb3VwcyhsZW4pLmF0KGxhc3QpLnZhbHVlO1xuICAgIHJldHVybiAhIWZpZWxkICYmICEhdmFsdWU7XG4gIH1cblxuICAvKiogQWRkcyBhIGZpZWxkIGRlZmluaXRpb24gdGhhdCB3YXMgbm90IGluY2x1ZGVkIGFzIHBhcnQgb2YgdGhlIGNvbnRlbnQgY2hpbGRyZW4uICovXG4gIGFkZEZpZWxkRGVmKGZpZWxkRGVmOiBCYXNlQ29uZGl0aW9uRmllbGREZWYpIHtcbiAgICB0aGlzLl9jdXN0b21GaWVsZERlZnMuYWRkKGZpZWxkRGVmKTtcbiAgfVxuXG4gIC8qKiBSZW1vdmVzIGEgZmllbGQgZGVmaW5pdGlvbiB0aGF0IHdhcyBub3QgaW5jbHVkZWQgYXMgcGFydCBvZiB0aGUgY29udGVudCBjaGlsZHJlbi4gKi9cbiAgcmVtb3ZlRmllbGREZWYoZmllbGREZWY6IEJhc2VDb25kaXRpb25GaWVsZERlZikge1xuICAgIHRoaXMuX2N1c3RvbUZpZWxkRGVmcy5kZWxldGUoZmllbGREZWYpO1xuICB9XG5cbiAgZ2V0RmllbGREZWZzQnlOYW1lKCkge1xuICAgIHJldHVybiB0aGlzLl9maWVsZERlZnNCeU5hbWU7XG4gIH1cblxuICBwcml2YXRlIF9jYWNoZUZpZWxkRGVmcygpIHtcbiAgICB0aGlzLl9maWVsZERlZnNCeU5hbWUuY2xlYXIoKTtcblxuICAgIGNvbnN0IGRlZnMgPSBbXG4gICAgICAvLyBEeW5hbWljYWxseSBBZGRlZCBEZWZpbml0aW9uc1xuICAgICAgLi4uQXJyYXkuZnJvbSh0aGlzLl9jdXN0b21GaWVsZERlZnMpLFxuICAgICAgLi4uQXJyYXkuZnJvbSh0aGlzLl9jb250ZW50RmllbGREZWZzKSxcbiAgICBdO1xuXG4gICAgZGVmcy5mb3JFYWNoKChmaWVsZERlZikgPT4ge1xuICAgICAgaWYgKHRoaXMuX2ZpZWxkRGVmc0J5TmFtZS5oYXMoZmllbGREZWYubmFtZSkpIHtcbiAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKGBkdXBsaWNhdGUgZmllbGQgbmFtZSBmb3IgJHtmaWVsZERlZi5uYW1lfWApO1xuICAgICAgfVxuICAgICAgdGhpcy5fZmllbGREZWZzQnlOYW1lLnNldChmaWVsZERlZi5uYW1lLCBmaWVsZERlZik7XG4gICAgfSk7XG4gIH1cbn1cbiIsIjxmb3JtIFtmb3JtR3JvdXBdPVwicGFyZW50Rm9ybVwiPlxuICA8bm92by1zdGFjayBbZm9ybUFycmF5TmFtZV09XCJjb250cm9sTmFtZVwiIGNsYXNzPVwiY3JpdGVyaWEtYnVpbGRlci1pbm5lclwiPlxuICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IGFuZEdyb3VwIG9mIGFuZEdyb3VwcygpLmNvbnRyb2xzOyBsZXQgYW5kSW5kZXggPSBpbmRleDsgbGV0IGlzRmlyc3QgPSBmaXJzdDtcIj5cbiAgICAgIDxkaXYgKm5nSWY9XCIhaXNGaXJzdFwiIGNsYXNzPVwiYW5kLWNvbm5lY3RvclwiIGFyaWEtaGlkZGVuPVwiZmFsc2VcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImFuZC1jb25uZWN0b3ItbGluZVwiPjwvZGl2PlxuICAgICAgICA8bm92by1jYXB0aW9uIGNsYXNzPVwiYW5kLWNvbm5lY3Rvci10ZXh0XCI+YW5kPC9ub3ZvLWNhcHRpb24+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxuZy1jb250YWluZXIgW2Zvcm1Hcm91cE5hbWVdPVwiYW5kSW5kZXhcIj5cbiAgICAgICAgPG5vdm8tc3RhY2tcbiAgICAgICAgICBjbGFzcz1cImNvbmRpdGlvbi1ncm91cFwiXG4gICAgICAgICAgW2NsYXNzLndpdGgtY29uZGl0aW9uc109XCJvckdyb3VwcyhhbmRJbmRleCkuY29udHJvbHMubGVuZ3RoID4gMVwiXG4gICAgICAgICAgW2NsYXNzLndpdGgtb25lLWNvbmRpdGlvbl09XCJvckdyb3VwcyhhbmRJbmRleCkuY29udHJvbHMubGVuZ3RoID09IDFcIlxuICAgICAgICAgIGZvcm1BcnJheU5hbWU9XCIkb3JcIj5cbiAgICAgICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICAgICAqbmdGb3I9XCJcbiAgICAgICAgICAgICAgbGV0IG9yR3JvdXAgb2Ygb3JHcm91cHMoYW5kSW5kZXgpLmNvbnRyb2xzO1xuICAgICAgICAgICAgICBsZXQgb3JJbmRleCA9IGluZGV4O1xuICAgICAgICAgICAgICBsZXQgaXNGaXJzdE9yID0gZmlyc3Q7XG4gICAgICAgICAgICAgIGxldCBpc0xhc3RPciA9IGxhc3Q7XG4gICAgICAgICAgICBcIj5cbiAgICAgICAgICAgIDxub3ZvLWZsZXggY2xhc3M9XCJjb25kaXRpb24tcm93XCIgW2NsYXNzLm9yLWJsb2NrXT1cIm9yR3JvdXBzKGFuZEluZGV4KS5jb250cm9scy5sZW5ndGggPiAxICYmICFpc0xhc3RPclwiPlxuICAgICAgICAgICAgICA8ZGl2ICpuZ0lmPVwiIWlzRmlyc3RPclwiIGNsYXNzPVwib3ItY29ubmVjdG9yXCIgYXJpYS1oaWRkZW49XCJmYWxzZVwiPlxuICAgICAgICAgICAgICAgIDwhLS0gPGRpdiBjbGFzcz1cIm9yLWNvbm5lY3Rvci1saW5lXCI+PC9kaXY+IC0tPlxuICAgICAgICAgICAgICAgIDxub3ZvLXRleHQgY2xhc3M9XCJvci1jb25uZWN0b3ItdGV4dFwiIGNvbG9yPVwib2NlYW5cIiB3ZWlnaHQ9XCJib2xkXCIgcGFkZGluZz1cInNtXCIgbXg9XCJsZ1wiPk9SPC9ub3ZvLXRleHQ+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8bm92by1jb25kaXRpb24tYnVpbGRlciBbZm9ybUdyb3VwTmFtZV09XCJvckluZGV4XCIgW2NvbmZpZ109XCJjb25maWdcIiBbZWRpdFR5cGVGbl09XCJlZGl0VHlwZUZuXCI+XG4gICAgICAgICAgICAgIDwvbm92by1jb25kaXRpb24tYnVpbGRlcj5cbiAgICAgICAgICAgICAgPGJ1dHRvbiAqbmdJZj1cImlzTGFzdE9yICYmIG9yRW5hYmxlZFwiIHRoZW1lPVwic2Vjb25kYXJ5XCIgc2l6ZT1cInNtXCIgY2xhc3M9XCJhbmQtb3ItYnV0dG9uXCJcbiAgICAgICAgICAgICAgICAoY2xpY2spPVwiYWRkT3JHcm91cChhbmRJbmRleClcIj5PcjwvYnV0dG9uPlxuICAgICAgICAgICAgICA8bm92by1idXR0b24gdGhlbWU9XCJpY29uXCIgaWNvbj1cImRlbGV0ZS1vXCIgY29sb3I9XCJuZWdhdGl2ZVwiIChjbGljayk9XCJyZW1vdmVPckdyb3VwKGFuZEluZGV4LCBvckluZGV4KVwiPlxuICAgICAgICAgICAgICA8L25vdm8tYnV0dG9uPlxuICAgICAgICAgICAgPC9ub3ZvLWZsZXg+XG4gICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvbm92by1zdGFjaz5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L25vdm8tc3RhY2s+XG4gIDxidXR0b24gY2xhc3M9XCJhbmQtb3ItYnV0dG9uXCIgdGhlbWU9XCJzZWNvbmRhcnlcIiBzaXplPVwic21cIiAoY2xpY2spPVwiYWRkQW5kR3JvdXAoKVwiPnt7IGFkZENyaXRlcmlhTGFiZWwgfX08L2J1dHRvbj5cblxuPC9mb3JtPlxuPG5vdm8taWQtY29uZGl0aW9uLWRlZiBuYW1lPVwiSURcIj48L25vdm8taWQtY29uZGl0aW9uLWRlZj5cbjxub3ZvLWRhdGUtY29uZGl0aW9uLWRlZiBuYW1lPVwiVElNRVNUQU1QXCI+PC9ub3ZvLWRhdGUtY29uZGl0aW9uLWRlZj5cbjxub3ZvLXN0cmluZy1jb25kaXRpb24tZGVmIG5hbWU9XCJTVFJJTkdcIj48L25vdm8tc3RyaW5nLWNvbmRpdGlvbi1kZWY+XG48bm92by1udW1iZXItY29uZGl0aW9uLWRlZiBuYW1lPVwiRkxPQVRcIj48L25vdm8tbnVtYmVyLWNvbmRpdGlvbi1kZWY+XG48bm92by1udW1iZXItY29uZGl0aW9uLWRlZiBuYW1lPVwiSU5URUdFUlwiPjwvbm92by1udW1iZXItY29uZGl0aW9uLWRlZj5cbjxub3ZvLW51bWJlci1jb25kaXRpb24tZGVmIG5hbWU9XCJCSUdERUNJTUFMXCI+PC9ub3ZvLW51bWJlci1jb25kaXRpb24tZGVmPlxuPG5vdm8tbnVtYmVyLWNvbmRpdGlvbi1kZWYgbmFtZT1cIkRPVUJMRVwiPjwvbm92by1udW1iZXItY29uZGl0aW9uLWRlZj5cbjxub3ZvLWFkZHJlc3MtY29uZGl0aW9uLWRlZiBuYW1lPVwiQUREUkVTU1wiPjwvbm92by1hZGRyZXNzLWNvbmRpdGlvbi1kZWY+XG48bm92by1ib29sZWFuLWNvbmRpdGlvbi1kZWYgbmFtZT1cIkJPT0xFQU5cIj48L25vdm8tYm9vbGVhbi1jb25kaXRpb24tZGVmPlxuPG5vdm8tcGlja2VyLWNvbmRpdGlvbi1kZWYgbmFtZT1cIlNFTEVDVFwiPjwvbm92by1waWNrZXItY29uZGl0aW9uLWRlZj5cbjxub3ZvLXN0cmluZy1jb25kaXRpb24tZGVmIG5hbWU9XCJERUZBVUxUXCI+PC9ub3ZvLXN0cmluZy1jb25kaXRpb24tZGVmPlxuXG48IS0tIFxuICB7XG4gICAgJGFuZDogW3tcbiAgICAgICRvcjogW3tcbiAgICAgICAgZW50aXR5OiAnSm9iT3JkZXInXG4gICAgICAgIGZpZWxkOiAnY2F0ZWdvcmllcycsXG4gICAgICAgIG9wZXJhdG9yOiAnZG9lc05vdENvbnRhaW4nLFxuICAgICAgICB2YWx1ZTogJ0hlYWx0aGNhcmUnXG4gICAgICB9XVxuICAgIH1dXG4gIH1cbiAtLT4iXX0=